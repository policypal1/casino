<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brainrot Mines</title>
<style>
*{box-sizing:border-box}
:root{
  --bg:#0b0e14; --ink:#e9f1ff; --muted:#9fb3c8;
  --accent:#1de9b6; --accent2:#ffd166; --danger:#ff5a5f;
  --card:#0f1626; --card2:#0d1220; --card-border:rgba(255,255,255,.10);
  --radius:18px; --shadow:0 10px 25px rgba(0,0,0,.35);
}
html,body{height:100%}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:var(--bg)}
.bg{position:fixed;inset:0;z-index:-2;background:
  radial-gradient(1200px 600px at 10% 10%, #2e1030 0%, transparent 60%),
  radial-gradient(1200px 600px at 90% 30%, #0f3b32 0%, transparent 60%),
  linear-gradient(120deg,#0b0e14,#0c121c)
}
.site-header{max-width:1180px;margin:12px auto 0;display:flex;align-items:center;justify-content:space-between}
.brand{color:#eafff6;text-decoration:none;font-weight:900}
.mainnav a{color:#b7c6d8;text-decoration:none;margin-left:14px;font-weight:800}
.mainnav a.active{color:#eafff6}
.card{max-width:1180px;margin:12px auto;padding:18px;border-radius:var(--radius);
  background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
  border:1px solid var(--card-border); box-shadow:var(--shadow)
}
.hud{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.stat{display:flex;gap:8px;align-items:center;margin-left:6px;color:var(--muted);font-weight:800}
.stat .v{color:var(--ink)}
.bet-stack{display:flex;flex-direction:column;gap:6px;margin-left:auto;min-width:280px;max-width:420px;flex:1}
.bet-row{display:flex;align-items:center;gap:8px}
.bet-row .k{color:var(--muted)}
#betInput{width:110px;padding:8px 10px;border-radius:12px;border:1px solid var(--card-border);background:#0e1524;color:#0ff7d7;font-weight:800}
#mineCount{width:100%}
.mine-actions{display:flex;gap:8px;align-items:center;margin-left:auto}
.btn{background:#18243a;color:#fff;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:900;letter-spacing:.3px;transition:.18s;box-shadow:var(--shadow)}
.btn:hover{transform:translateY(-1px)}
.btn:disabled{opacity:.55;cursor:not-allowed}
.btn.ghost{background:transparent}
.btn.danger{background:#30151a;border:1px solid rgba(255,90,95,.35);color:#ffb3b6}
.machine-bar{display:flex;justify-content:center;margin-bottom:10px}
.machine-title{font-weight:900;letter-spacing:.4px}
.board{display:grid;gap:10px;background:var(--card2);border:1px solid var(--card-border);padding:18px;border-radius:16px}
.board-5x5{grid-template-columns:repeat(5,1fr)}
.cell{
  position:relative; aspect-ratio:1/1; border-radius:12px;
  background:linear-gradient(180deg,#0a1121,#0f1a2f);
  border:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer; user-select:none; transition:.12s ease;
}
.cell:hover{transform:translateY(-1px)}
.cell.revealed{cursor:default;transform:none}
.cell .mark{font-size:34px;line-height:1}
.cell.safe img{width:60%;height:auto;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.45))}
.cell.bomb{background:linear-gradient(180deg,#2a0c10,#42131a);border-color:rgba(255,90,95,.35)}
.cell.safe{background:linear-gradient(180deg,#10222f,#12344c);border-color:rgba(29,233,182,.35)}
.message{margin-top:12px;min-height:24px;color:var(--accent2);font-weight:900;letter-spacing:.3px}
.admin.hidden{display:none}
.admin .admin-row{margin:.25rem 0 .75rem}
.admin .admin-simple{display:flex;gap:8px;align-items:center}
.admin .admin-simple input{width:160px;padding:10px;border-radius:12px;border:1px solid var(--card-border);background:#0e1524;color:#0ff7d7;font-weight:800}
.admin-actions{margin-top:10px}
.muted{color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
  <div class="bg"></div>

  <header class="site-header">
    <a class="brand" href="/">🧠 Brainrot Casino</a>
    <nav class="mainnav">
      <a href="/">Slots</a>
      <a class="active" href="/mines.html">Mines</a>
    </nav>
  </header>

  <section class="hud card">
    <div class="stat">
      <span class="k">User</span>
      <select id="userSelect" aria-label="Select user">
        <option>Will</option><option>Isaac</option><option>Faisal</option><option>Muhammed</option>
      </select>
    </div>

    <div class="stat">
      <span class="k">Balance</span>
      <span id="tokenBalance" class="v">0🪙</span>
    </div>

    <div class="bet-stack">
      <div class="bet-row">
        <span class="k">Bet</span>
        <input id="betInput" type="number" step="0.01" min="0.01" value="0.50" />
        <span class="unit">🪙</span>
      </div>
      <div class="bet-row">
        <label class="k" for="mineCount">Mines</label>
        <input id="mineCount" type="range" min="1" max="24" value="3" />
        <span id="mineCountVal" class="v">3</span>
      </div>
    </div>

    <div class="stat"><span class="k">Revealed</span><span id="revealedCount" class="v">0</span></div>
    <div class="stat"><span class="k">Multiplier</span><span id="multiplier" class="v">1.00×</span></div>
    <div class="stat"><span class="k">Cashout</span><span id="cashoutValue" class="v">0🪙</span></div>

    <div class="mine-actions">
      <button id="startBtn" class="btn">Start Round</button>
      <button id="cashoutBtn" class="btn danger" disabled>Cash Out</button>
      <button id="resetBtn" class="btn ghost" disabled>New Round</button>
    </div>

    <button id="adminToggle" class="btn ghost">Admin</button>
  </section>

  <main>
    <section class="card">
      <header class="machine-bar"><div class="machine-title">Mines — 5×5 board</div></header>
      <div id="board" class="board board-5x5" aria-live="polite" aria-atomic="true"></div>
      <div id="message" class="message" role="status" aria-live="polite"></div>
    </section>

    <section id="adminPanel" class="admin card hidden" aria-hidden="true" tabindex="-1">
      <h2>Admin</h2>
      <div class="admin-row"><label>Selected User: <strong id="adminUserLabel">Will</strong></label></div>
      <div class="admin-simple">
        <label for="adminAdd">Add Coins</label>
        <input id="adminAdd" type="number" min="0" step="0.01" />
        <button id="adminGive" class="btn" type="button">Give</button>
      </div>
      <div class="admin-actions"><button id="closeAdmin" class="btn ghost" type="button">Close</button></div>
      <p class="muted">Local demo balance only.</p>
    </section>
  </main>

<script>
/* Single-file Brainrot Mines */
const wait = (ms)=> new Promise(r=>setTimeout(r, ms));
const round3 = (n)=> Math.round((n + Number.EPSILON) * 1000) / 1000;
const fmtTok = (n)=> (round3(n)).toFixed(3).replace(/\.?0+$/,'');
(() => {
  const BOARD_SIZE=25, COLS=5, HOUSE_EDGE=0.97;
  const USERS=["Will","Isaac","Faisal","Muhammed"];
  const STORE="brainrot-shared-balance";              // share balance with other pages if you want
  const baseUser=()=>({tokens:0,earned:0,spent:0});
  function load(){
    try{
      const raw=JSON.parse(localStorage.getItem(STORE)||"{}");
      for(const u of USERS) if(!raw[u]) raw[u]=baseUser();
      return raw;
    }catch{ return Object.fromEntries(USERS.map(u=>[u,baseUser()])); }
  }
  let stats=load();
  function save(){ localStorage.setItem(STORE, JSON.stringify(stats)); }

  let currentUser = USERS.includes(localStorage.getItem("br-user")) ? localStorage.getItem("br-user") : "Will";
  let roundActive=false, mines=new Set(), revealedSafe=0, chosenMines=3, bet=0.50;

  const userSelect=document.getElementById("userSelect");
  const tokenBalanceEl=document.getElementById("tokenBalance");
  const betInput=document.getElementById("betInput");
  const mineCount=document.getElementById("mineCount");
  const mineCountVal=document.getElementById("mineCountVal");
  const revealedCount=document.getElementById("revealedCount");
  const multiplierEl=document.getElementById("multiplier");
  const cashoutValueEl=document.getElementById("cashoutValue");
  const messageEl=document.getElementById("message");
  const boardEl=document.getElementById("board");
  const startBtn=document.getElementById("startBtn");
  const cashoutBtn=document.getElementById("cashoutBtn");
  const resetBtn=document.getElementById("resetBtn");
  const adminToggle=document.getElementById("adminToggle");
  const adminPanel=document.getElementById("adminPanel");
  const adminUserLabel=document.getElementById("adminUserLabel");
  const adminAdd=document.getElementById("adminAdd");
  const adminGive=document.getElementById("adminGive");
  const closeAdmin=document.getElementById("closeAdmin");

  userSelect.value=currentUser;
  mineCountVal.textContent=mineCount.value;
  renderBalance(); syncBet(); buildBoard(); updateRoundUI();

  function renderBalance(){
    tokenBalanceEl.textContent = fmtTok(stats[currentUser]?.tokens||0) + "🪙";
  }
  function syncBet(){
    bet=Math.max(0.01, round3(Number(betInput.value)||0.5));
    betInput.value=String(bet);
  }
  function setMessage(m){ messageEl.textContent=m||""; }

  function buildBoard(){
    boardEl.innerHTML="";
    for(let i=0;i<BOARD_SIZE;i++){
      const c=document.createElement("button");
      c.className="cell"; c.type="button"; c.dataset.idx=String(i);
      c.addEventListener("click", onCellClick);
      boardEl.appendChild(c);
    }
  }
  function sampleMines(count){
    const s=new Set(); while(s.size<count) s.add(Math.floor(Math.random()*BOARD_SIZE)); return s;
  }
  function currentMultiplier(revealed, totalMines){
    if (revealed<=0) return 1.0;
    let mult=1.0;
    for(let i=0;i<revealed;i++){
      const remaining=BOARD_SIZE-i;
      const remainingSafe=(BOARD_SIZE-totalMines)-i;
      mult*=remaining/remainingSafe;
    }
    return mult*HOUSE_EDGE;
  }
  function updateRoundUI(){
    revealedCount.textContent=String(revealedSafe);
    const mult=currentMultiplier(revealedSafe, chosenMines);
    multiplierEl.textContent=`${mult.toFixed(2)}×`;
    cashoutValueEl.textContent=(revealedSafe>0?fmtTok(round3(bet*mult)):"0")+"🪙";
    startBtn.disabled=roundActive;
    resetBtn.disabled=!roundActive;
    cashoutBtn.disabled=!(roundActive && revealedSafe>0);
    mineCount.disabled=roundActive;
    betInput.disabled=roundActive;
    userSelect.disabled=roundActive;
  }
  function endRound(win){
    roundActive=false;
    if(win>0){
      stats[currentUser].tokens=round3((stats[currentUser].tokens||0)+win);
      stats[currentUser].earned=round3((stats[currentUser].earned||0)+win);
      setMessage(`Cashed out +${fmtTok(win)}🪙`);
    }
    save(); renderBalance(); updateRoundUI();
  }
  function revealAllBombs(){
    document.querySelectorAll(".cell").forEach(cell=>{
      const idx=Number(cell.dataset.idx);
      if(mines.has(idx)){ cell.classList.add("revealed","bomb"); cell.innerHTML=`<span class="mark">💣</span>`; }
      cell.disabled=true;
    });
  }
  function markSafe(cell){
    cell.classList.add("revealed","safe");
    // Use image if present, else fallback emoji
    const imgPath="./Strawberryelephant.webp";
    const img=new Image(); img.alt="Strawberry Elephant"; img.onload=()=>{ cell.innerHTML=""; cell.appendChild(img); };
    img.onerror=()=>{ cell.innerHTML=`<span class="mark">🍓🐘</span>`; };
    img.src=imgPath; img.style.width="60%"; img.style.height="auto"; img.style.display="block";
    cell.disabled=true;
  }

  userSelect.addEventListener("change", ()=>{ currentUser=userSelect.value; localStorage.setItem("br-user",currentUser); renderBalance(); });
  betInput.addEventListener("input", ()=>{ syncBet(); updateRoundUI(); });
  mineCount.addEventListener("input", ()=>{ mineCountVal.textContent=mineCount.value; chosenMines=Number(mineCount.value); updateRoundUI(); });

  startBtn.addEventListener("click", ()=>{
    syncBet();
    const bal=stats[currentUser]?.tokens||0;
    if(bal+1e-9<bet){ setMessage("Insufficient tokens. Use Admin to add coins for testing."); return; }
    stats[currentUser].tokens=round3(bal-bet);
    stats[currentUser].spent=round3((stats[currentUser].spent||0)+bet);
    save(); renderBalance();
    chosenMines=Number(mineCount.value);
    mines=sampleMines(chosenMines);
    revealedSafe=0; roundActive=true; setMessage("Round started. Pick a tile!");
    document.querySelectorAll(".cell").forEach(c=>{ c.className="cell"; c.innerHTML=""; c.disabled=false; });
    updateRoundUI();
  });

  cashoutBtn.addEventListener("click", ()=>{
    if(!roundActive || revealedSafe<=0) return;
    const mult=currentMultiplier(revealedSafe, chosenMines);
    const win=round3(bet*mult);
    document.querySelectorAll(".cell").forEach(c=> c.disabled=true);
    endRound(win);
  });

  resetBtn.addEventListener("click", ()=>{ roundActive=false; mines.clear(); revealedSafe=0; setMessage(""); buildBoard(); updateRoundUI(); });

  async function onCellClick(e){
    if(!roundActive) return;
    const cell=e.currentTarget; const idx=Number(cell.dataset.idx);
    if(mines.has(idx)){
      cell.classList.add("revealed","bomb"); cell.innerHTML=`<span class="mark">💣</span>`;
      await wait(120); revealAllBombs(); setMessage("💥 Boom! You hit a bomb. Bet lost."); roundActive=false; updateRoundUI(); return;
    }
    markSafe(cell); revealedSafe++;
    const mult=currentMultiplier(revealedSafe, chosenMines);
    const cashVal=round3(bet*mult);
    setMessage(`Safe! Multiplier: ${mult.toFixed(2)}× — Cashout: +${fmtTok(cashVal)}🪙`);
    updateRoundUI();
  }

  adminToggle?.addEventListener("click", ()=>{ adminUserLabel.textContent=currentUser; adminPanel.classList.remove("hidden"); });
  closeAdmin?.addEventListener("click", ()=> adminPanel.classList.add("hidden"));
  adminGive?.addEventListener("click", ()=>{ const s=stats[currentUser]; const amt=Math.max(0, Number(adminAdd.value||"0")); if(!Number.isFinite(amt)||amt<=0) return;
    s.tokens=round3((s.tokens||0)+amt); save(); renderBalance(); adminAdd.value=""; setMessage(`Admin +${fmtTok(amt)}🪙`); });
})();
</script>
</body>
</html>
